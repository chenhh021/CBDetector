diff --git a/gradle/validation/error-prone.gradle b/gradle/validation/error-prone.gradle
index b092117..205f608 100644
--- a/gradle/validation/error-prone.gradle
+++ b/gradle/validation/error-prone.gradle
@@ -17,12 +17,12 @@
 
 def skipReason
 
-if (rootProject.runtimeJavaVersion > JavaVersion.VERSION_15) {
-  skipReason = "won't work with JDK ${rootProject.runtimeJavaVersion}"
+if (rootProject.usesAltJvm && rootProject.runtimeJavaVersion > JavaVersion.VERSION_15) {
+  skipReason = "won't work with JDK ${rootProject.runtimeJavaVersion} if used as alternative java toolchain"
 }
 
 if (!Boolean.parseBoolean(propertyOrDefault("tests.nightly", "false"))) {
-  skipReason = "skipped on non-nightly runs"
+  skipReason = "skipped on non-nightly runs, pass -Dtests.nightly=true to run"
 }
 
 if (skipReason) {
@@ -37,8 +37,10 @@
 
 allprojects { prj ->
   plugins.withType(JavaPlugin) {
-    // LUCENE-9650: Errorprone on master/gradle does not work with JDK-16+
-    // this is a hack to keep the dependency (so that palantir's version check doesn't complain)
+    // LUCENE-9650: Errorprone on master/gradle does not work with JDK-16+ when running as plugin
+    // inside a forked Javac process. Javac running inside Gradle works, because we have
+    // additional module system opens in place.
+    // This is a hack to keep the dependency (so that palantir's version check doesn't complain)
     // but don't include the plugin (which fails on JDK16+).
     if (skipReason) {
       tasks.withType(JavaCompile) { task -> task.dependsOn ":errorProneSkipped" }
@@ -58,123 +60,110 @@
       tasks.withType(JavaCompile) { task ->
         options.errorprone.disableWarningsInGeneratedCode = true
         options.errorprone.errorproneArgs = [
-            // test
-            '-Xep:ExtendingJUnitAssert:OFF',
-            '-Xep:UseCorrectAssertInTests:OFF',
-            '-Xep:DefaultPackage:OFF',
-            '-Xep:FloatingPointLiteralPrecision:OFF',
-            '-Xep:CatchFail:OFF',
-            '-Xep:TryFailThrowable:OFF',
-            '-Xep:MathAbsoluteRandom:OFF',
-            '-Xep:AssertionFailureIgnored:OFF',
-            '-Xep:JUnit4TestNotRun:OFF',
-            '-Xep:FallThrough:OFF',
-            '-Xep:CatchAndPrintStackTrace:OFF',
-            '-Xep:ToStringReturnsNull:OFF',
-            '-Xep:ArrayAsKeyOfSetOrMap:OFF',
-            '-Xep:StaticAssignmentInConstructor:OFF',
-            '-Xep:SelfAssignment:OFF',
-            '-Xep:InvalidPatternSyntax:OFF',
-            '-Xep:MissingFail:OFF',
-            '-Xep:LossyPrimitiveCompare:OFF',
-            '-Xep:ComparableType:OFF',
-            '-Xep:InfiniteRecursion:OFF',
-            '-Xep:MisusedDayOfYear:OFF',
-            '-Xep:FloatingPointAssertionWithinEpsilon:OFF',
+            '-Xep:InlineMeSuggester:OFF', // We don't use this annotation
 
-            '-Xep:ThrowNull:OFF',
-            '-Xep:StaticGuardedByInstance:OFF',
-            '-Xep:ArrayHashCode:OFF',
-            '-Xep:ArrayEquals:OFF',
-            '-Xep:IdentityBinaryExpression:OFF',
-            '-Xep:ComplexBooleanConstant:OFF',
-            '-Xep:ComplexBooleanConstant:OFF',
-            '-Xep:StreamResourceLeak:OFF',
-            '-Xep:UnnecessaryLambda:OFF',
-            '-Xep:ObjectToString:OFF',
-            '-Xep:URLEqualsHashCode:OFF',
-            '-Xep:DoubleBraceInitialization:OFF',
-            '-Xep:ShortCircuitBoolean:OFF',
-            '-Xep:InputStreamSlowMultibyteRead:OFF',
-            '-Xep:NonCanonicalType:OFF',
-            '-Xep:CollectionIncompatibleType:OFF',
-            '-Xep:TypeParameterShadowing:OFF',
-            '-Xep:ThreadJoinLoop:OFF',
-            '-Xep:MutableConstantField:OFF',
-            '-Xep:ReturnValueIgnored:OFF',
-            '-Xep:CollectionIncompatibleType:OFF',
-            '-Xep:SameNameButDifferent:OFF',
-            '-Xep:InvalidParam:OFF',
-            '-Xep:CompareToZero:OFF',
-            '-Xep:DoubleCheckedLocking:OFF',
-            '-Xep:BadShiftAmount:OFF',
-            '-Xep:CollectionUndefinedEquality:OFF',
-            '-Xep:UnescapedEntity:OFF',
-            '-Xep:BoxedPrimitiveEquality:OFF',
-            '-Xep:LogicalAssignment:OFF',
-            '-Xep:DoubleCheckedLocking:OFF',
-            '-Xep:AmbiguousMethodReference:OFF',
-            '-Xep:FormatString:OFF',
-            '-Xep:InstanceOfAndCastMatchWrongType:OFF',
-            '-Xep:ModifyCollectionInEnhancedForLoop:OFF',
-            '-Xep:JavaLangClash:OFF',
-            '-Xep:TypeParameterUnusedInFormals:OFF',
-            '-Xep:UnusedNestedClass:OFF',
-            '-Xep:OverrideThrowableToString:OFF',
-            '-Xep:FutureReturnValueIgnored:OFF',
-            '-Xep:BadInstanceof:OFF',
-            '-Xep:UnusedNestedClass:OFF',
-            '-Xep:OverrideThrowableToString:OFF',
-            '-Xep:EqualsIncompatibleType:OFF',
-            '-Xep:ByteBufferBackingArray:OFF',
-            '-Xep:ByteBufferBackingArray:OFF',
-            '-Xep:UnusedMethod:OFF',
-            '-Xep:ObjectsHashCodePrimitive:OFF',
-            '-Xep:ObjectsHashCodePrimitive:OFF',
-            '-Xep:UnnecessaryAnonymousClass:OFF',
-            '-Xep:BoxedPrimitiveConstructor:OFF',
-            '-Xep:ArgumentSelectionDefectChecker:OFF',
-            '-Xep:StringSplitter:OFF',
-            '-Xep:MixedMutabilityReturnType:OFF',
-            '-Xep:EqualsUnsafeCast:OFF',
-            '-Xep:OperatorPrecedence:OFF',
-            '-Xep:HidingField:OFF',
-            '-Xep:ThreadPriorityCheck:OFF',
-            '-Xep:InlineFormatString:OFF',
-            '-Xep:EqualsUnsafeCast:OFF',
-            '-Xep:UnsynchronizedOverridesSynchronized:OFF',
-            '-Xep:OperatorPrecedence:OFF',
-            '-Xep:ArrayToString:OFF',
-            '-Xep:ClassCanBeStatic:OFF',
-            '-Xep:InvalidInlineTag:OFF',
-            '-Xep:EmptyCatch:OFF',
-            '-Xep:UnnecessaryParentheses:OFF',
+            // test
             '-Xep:AlmostJavadoc:OFF',
-            '-Xep:Finally:OFF',
-            '-Xep:ImmutableEnumChecker:OFF',
-            '-Xep:NonAtomicVolatileUpdate:OFF',
-            '-Xep:MutablePublicArray:OFF',
-            '-Xep:LockNotBeforeTry:OFF',
-            '-Xep:WaitNotInLoop:OFF',
-            '-Xep:UndefinedEquals:OFF',
-            '-Xep:JdkObsolete:OFF',
-            '-Xep:NarrowingCompoundAssignment:OFF',
-            '-Xep:InconsistentCapitalization:OFF',
-            '-Xep:IntLongMath:OFF',
-            '-Xep:SynchronizeOnNonFinalField:OFF',
-            '-Xep:ThreadLocalUsage:OFF',
-            '-Xep:ProtectedMembersInFinalClass:OFF',
+            '-Xep:AmbiguousMethodReference:OFF',
+            '-Xep:ArgumentSelectionDefectChecker:OFF',
+            '-Xep:ArrayAsKeyOfSetOrMap:OFF',
+            '-Xep:ArrayEquals:OFF',
+            '-Xep:ArrayHashCode:OFF',
+            '-Xep:ArrayToString:OFF',
+            '-Xep:AssertionFailureIgnored:OFF',
             '-Xep:BadImport:OFF',
-            '-Xep:InconsistentHashCode:OFF',
-            '-Xep:MissingOverride:OFF',
+            '-Xep:BadInstanceof:OFF',
+            '-Xep:BadShiftAmount:OFF',
+            '-Xep:BoxedPrimitiveConstructor:OFF', // we have forbiddenapis for that
+            '-Xep:ByteBufferBackingArray:OFF',
+            '-Xep:CatchAndPrintStackTrace:OFF',
+            '-Xep:CatchFail:OFF',
+            '-Xep:CharacterGetNumericValue:OFF',
+            '-Xep:ClassCanBeStatic:OFF',
+            '-Xep:CollectionIncompatibleType:OFF',
+            '-Xep:CollectionUndefinedEquality:OFF',
+            '-Xep:ComparableType:OFF',
+            '-Xep:ComplexBooleanConstant:OFF',
+            '-Xep:DefaultPackage:OFF',
+            '-Xep:DoNotCallSuggester:OFF',
+            '-Xep:DoubleBraceInitialization:OFF',
+            '-Xep:DoubleCheckedLocking:OFF',
+            '-Xep:EmptyCatch:OFF',
             '-Xep:EqualsGetClass:OFF',
-            '-Xep:PublicConstructorForAbstractClass:OFF',
+            '-Xep:EqualsIncompatibleType:OFF',
+            '-Xep:EqualsUnsafeCast:OFF',
             '-Xep:EscapedEntity:OFF',
-            '-Xep:ModifiedButNotUsed:OFF',
-            '-Xep:ReferenceEquality:OFF',
+            '-Xep:ExtendingJUnitAssert:OFF',
+            '-Xep:FallThrough:OFF',
+            '-Xep:Finally:OFF',
+            '-Xep:FloatingPointLiteralPrecision:OFF',
+            '-Xep:FormatString:OFF',
+            '-Xep:FutureReturnValueIgnored:OFF',
+            '-Xep:HidingField:OFF',
+            '-Xep:IdentityBinaryExpression:OFF',
+            '-Xep:IdentityHashMapUsage:OFF',
+            '-Xep:ImmutableEnumChecker:OFF',
+            '-Xep:InconsistentCapitalization:OFF',
+            '-Xep:InconsistentHashCode:OFF',
+            '-Xep:InfiniteRecursion:OFF',
+            '-Xep:InlineFormatString:OFF',
+            '-Xep:InputStreamSlowMultibyteRead:OFF',
+            '-Xep:IntLongMath:OFF',
             '-Xep:InvalidBlockTag:OFF',
+            '-Xep:InvalidInlineTag:OFF',
+            '-Xep:InvalidParam:OFF',
+            '-Xep:InvalidPatternSyntax:OFF',
+            '-Xep:JUnit4TestNotRun:OFF',
+            '-Xep:JavaLangClash:OFF',
+            '-Xep:JavaUtilDate:OFF',
+            '-Xep:JdkObsolete:OFF',
+            '-Xep:LockNotBeforeTry:OFF',
+            '-Xep:LogicalAssignment:OFF',
+            '-Xep:MathAbsoluteRandom:OFF',
+            '-Xep:MissingFail:OFF',
+            '-Xep:MissingOverride:OFF',
             '-Xep:MissingSummary:OFF',
-            '-Xep:UnusedVariable:OFF'
+            '-Xep:MisusedDayOfYear:OFF',
+            '-Xep:MixedMutabilityReturnType:OFF',
+            '-Xep:ModifiedButNotUsed:OFF',
+            '-Xep:MutableConstantField:OFF',
+            '-Xep:MutablePublicArray:OFF',
+            '-Xep:NarrowingCompoundAssignment:OFF',
+            '-Xep:NonAtomicVolatileUpdate:OFF',
+            '-Xep:NonCanonicalType:OFF',
+            '-Xep:ObjectToString:OFF',
+            '-Xep:ObjectsHashCodePrimitive:OFF',
+            '-Xep:OperatorPrecedence:OFF',
+            '-Xep:ProtectedMembersInFinalClass:OFF',
+            '-Xep:PublicConstructorForAbstractClass:OFF',
+            '-Xep:ReferenceEquality:OFF',
+            '-Xep:ReturnValueIgnored:OFF',
+            '-Xep:SameNameButDifferent:OFF',
+            '-Xep:SelfAssignment:OFF',
+            '-Xep:ShortCircuitBoolean:OFF',
+            '-Xep:StaticAssignmentInConstructor:OFF',
+            '-Xep:StaticGuardedByInstance:OFF',
+            '-Xep:StreamResourceLeak:OFF',
+            '-Xep:StringSplitter:OFF',
+            '-Xep:SynchronizeOnNonFinalField:OFF',
+            '-Xep:ThreadJoinLoop:OFF',
+            '-Xep:ThreadLocalUsage:OFF',
+            '-Xep:ThreadPriorityCheck:OFF',
+            '-Xep:ThrowNull:OFF',
+            '-Xep:ToStringReturnsNull:OFF',
+            '-Xep:TryFailThrowable:OFF',
+            '-Xep:TypeParameterShadowing:OFF',
+            '-Xep:TypeParameterUnusedInFormals:OFF',
+            '-Xep:UndefinedEquals:OFF',
+            '-Xep:UnescapedEntity:OFF',
+            '-Xep:UnicodeEscape:OFF',
+            '-Xep:UnnecessaryLambda:OFF',
+            '-Xep:UnnecessaryParentheses:OFF',
+            '-Xep:UnsynchronizedOverridesSynchronized:OFF',
+            '-Xep:UnusedMethod:OFF',
+            '-Xep:UnusedVariable:OFF',
+            '-Xep:UseCorrectAssertInTests:OFF',
+            '-Xep:WaitNotInLoop:OFF',
         ]
       }
     }
